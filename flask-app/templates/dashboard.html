{% extends "base.html" %}
{% block content %}
<div class="dashboard-header">
    <div class="overall-stats" id="overall-stats">
        <span>Loading overall progress...</span>
    </div>
</div>

<div class="dashboard">
    <h2>Select API/Drug</h2>
    <div class="api-grid">
        {% for api in apis %}
        <div class="api-card" onclick="window.location.href='/api/{{ api.name|urlencode }}'">
            <div class="api-name">{{ api.name }}</div>
            <div class="api-stats">
                <div class="stat-icon">üìä</div>
                <div class="stat-text">{{ api.total_pads }} PAD#s</div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" style="width: {{ api.progress }}%"></div>
                <div class="progress-text">{{ api.completed_pads }}/{{ api.total_pads }} complete</div>
            </div>
            <button class="enter-btn">Enter ‚Üí</button>
        </div>
        {% endfor %}

        <!-- Gallery Card -->
        <div class="api-card gallery-card" onclick="window.location.href='/gallery'">
            <div class="api-name">üì∏ Image Gallery</div>
            <div class="api-stats">
                <div class="stat-icon">üîç</div>
                <div class="stat-text">Quality Review</div>
            </div>
            <div class="gallery-description">
                Review image quality across different lighting conditions
            </div>
            <button class="enter-btn">View Gallery ‚Üí</button>
        </div>

        <!-- Unmatched Cards Card -->
        <div class="api-card gallery-card" onclick="window.location.href='/cards-gallery'">
            <div class="api-name">üîç Unmatched Cards</div>
            <div class="api-stats">
                <div class="stat-icon">{{ stats.total_project_cards - stats.total_matches }}</div>
                <div class="stat-text">Cards to Review</div>
            </div>
            <div class="gallery-description">
                Browse and match project cards not yet linked to annotations
            </div>
            <button class="enter-btn">View Cards ‚Üí</button>
        </div>
    </div>
</div>

<div class="actions">
    <button class="export-btn" onclick="exportData()">Export All Matched Data</button>
</div>

<script>
// Load overall stats
fetch('/api/stats')
    .then(res => res.json())
    .then(data => {
        document.getElementById('overall-stats').innerHTML = `
            Overall Progress: ${data.completed_pads}/${data.total_pads} PAD#s complete
            (${data.pad_progress.toFixed(1)}%)
        `;
    });

function exportData() {
    window.location.href = '/api/export';
}
</script>
{% endblock %}