{% extends "base.html" %}
{% block content %}
<header>
    <h1>ChemoPAD Annotation Matcher</h1>
    <div class="overall-stats" id="overall-stats">
        <span>Loading overall progress...</span>
    </div>
</header>

<div class="dashboard">
    <h2>Select API/Drug</h2>
    <div class="api-grid">
        {% for api in apis %}
        <div class="api-card" onclick="window.location.href='/api/{{ api.name|urlencode }}'">
            <div class="api-name">{{ api.name }}</div>
            <div class="api-stats">
                <div class="stat-icon">ðŸ“Š</div>
                <div class="stat-text">{{ api.total_pads }} PAD#s</div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" style="width: {{ api.progress }}%"></div>
                <div class="progress-text">{{ api.completed_pads }}/{{ api.total_pads }} complete</div>
            </div>
            <button class="enter-btn">Enter â†’</button>
        </div>
        {% endfor %}
    </div>
</div>

<div class="actions">
    <button class="export-btn" onclick="exportData()">Export All Matched Data</button>
</div>

<script>
// Load overall stats
fetch('/api/stats')
    .then(res => res.json())
    .then(data => {
        document.getElementById('overall-stats').innerHTML = `
            Overall Progress: ${data.completed_pads}/${data.total_pads} PAD#s complete
            (${data.pad_progress.toFixed(1)}%)
        `;
    });

function exportData() {
    window.location.href = '/api/export';
}
</script>
{% endblock %}